## О проекте

Целью настоящего проекта является сравнение эффективности различных способов вставки множества строк в таблицу реляционной БД. В проекте было реализовано 7 различных методов вставки (методы `m0()..m6()` в классе `Insert.java`), каждый из которых осуществляет запись в таблицу 1000 строк, состоящих из первичного ключа, генерируемого СУБД, и короткого текстового поля переменной длины (`VARCHAR(32)`). Внутри метода производится замер суммарного времени выполнения вставки, и полученное значение (в *мс*) возвращается в виде выходного параметра метода. Измерения проводились для трех типов СУБД: PostgreSQL 9.3, встраиваемая СУБД H2 в режиме работы с дисковым файлом, и H2 в режиме in-memory.

Первая группа методов (`m0()..m3()`) основана на использовании чистого JDBC. В методе `m0()` вставка каждой строки осуществляется отдельной транзакцией (в режиме автофиксации команд) с использованием объекта `Statement`. В методе `m1()` также используется объект `Statement`, однако все операции выполняются внутри одной транзакции. В методе `m2()` вставка осуществляется с использованием `PreparedStatement` (внутри одной транзакции). В методе `m3()` также используется подготовленное выражение, но запись при этом осуществляется в пакетном (batch) режиме.

Метод `m4()` для вставки строк использует средства ORM (Hibernate). В методе `m5()` также используется Hibernate, однако вставка осуществляется с применением NativeQuery. И, наконец, в методе `m6()` используется класс `JdbcTemplate` из фреймворка Spring.

### Основные результаты

На Рисунке 1 представлены результаты измерений (в *мс*) для PostgreSQL.

![img1](../resources/images/img1.png "Вставка 1000 строк для PostgreSQL")

На графиках приняты следующие условные обозначения:

    <Stm>..<Stm> - вставка в режиме AutoCommit с использованием Statement;
    <Stm> - вставка внутри одной транзакции с использованием Statement;
    <PrStm> - вставка внутри одной транзакции с использованием PreparedStatement;
    <Batch> - вставка внутри одной транзакции с использованием PreparedStatement и batch-режима;
    <Hib-ORM> - вставка с использованием Hibernate-ORM;
    <Hib-SQL> - вставка с использованием Hibernate-NativeQuery;
    <JdbcTempl> - вставка с использованием JdbcTemplate.

Измеренный интервал учитывает время выполнения команд `createStatement()`, `prepareStatement()` и  `createNativeQuery()`, а также команды`commit()`. Соответствующие данные для СУБД H2 показаны на Рисунках 2, 3.

![img2](../resources/images/img2.png "Вставка 1000 строк для H2 при работе с файлом")

![img3](../resources/images/img3.png "Вставка 1000 строк для H2 в режиме in-memory")

Из приведенных графиков видно, что с точки зрения производительности наиболее эффективными методами вставки являются `JdbcTemplate` или batch-режим в JDBC. Использование высокоуровневых средств (Hibernate) увеличивает время вставки в 4-6 раз по сравнению с минимально возможным для данной СУБД. Кроме того, время записи для встраиваемой СУБД (при работе с файлом) в 2-5 раз меньше, чем для внешней СУБД. При работе с памятью эта разница увеличивается до 10-15 раз.

Для построения графиков (класс `Plotter.java`) использовалась свободная утилита gnuplot, которая (начиная с версии 5.0.1) предоставляет стандартный поток для ввода данных и команд из внешнего приложения.

### История версий

* Версия 1.0 - базовая версия.
* Версия 1.1 - добавлен метод вставки на основе Hibernate-NativeQuery; сущность `Word` перенесена в отдельный пакет.